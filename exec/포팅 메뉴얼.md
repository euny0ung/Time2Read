# í¬íŒ… ë©”ë‰´ì–¼

# 1. í”„ë¡œì íŠ¸ ê°œìš”

ë‹¹ì‹ ì€ ê³¼ê±°ì˜ ë‰´ìŠ¤ê°€ í˜„ì¬ì™€ ë¯¸ë˜ë¥¼ ì´í•´í•˜ëŠ”ë° ì–¼ë§ˆë‚˜ ì¤‘ìš”í•œ ì—­í• ì„ í•˜ëŠ”ì§€ ì•Œê³  ê³„ì‹­ë‹ˆê¹Œ?
ìš°ë¦¬ì˜ ì„œë¹„ìŠ¤ë¥¼ í†µí•´ ì—­ì‚¬ì  ìˆœê°„ë“¤ì„ íƒí—˜í•˜ê³ , ê·¸ ë‹¹ì‹œì˜ íë¦„ê³¼ ì‚¬ê±´ë“¤ì„ ë˜ì§šì–´ ë³´ëŠ” ë° ë„ì›€ì´ ë  ê±°ì—ìš”.
ê³¼ê±°ì˜ ë‰´ìŠ¤ ê¸°ì‚¬ë“¤ì„ ì½ê³ , ê·¸ ë‹¹ì‹œì˜ ì‚¬íšŒì , ì •ì¹˜ì  í’ê²½ì„ ì‚´í´ë³´ë©° ì—­ì‚¬ì  ì§€ì‹ì„ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”.
ë…„ë„ë³„ë¡œ ë‹¤ë¥¸ í€´ì¦ˆë¥¼ í’€ì–´ë³´ë©° ê·¸ í•´ì˜ íŠ¸ë Œë“œì™€ ì£¼ìš” ì‚¬ê±´ë“¤ì„ íŒŒì•…í•  ìˆ˜ ìˆì–´ìš”.
ê³¼ê±°ë¡œ ë– ë‚˜ëŠ” ì—¬í–‰! ì§€ê¸ˆ ì‹œì‘í•´ë³´ì„¸ìš”.

# 2. í”„ë¡œì íŠ¸ ì‚¬ìš©ë„êµ¬

### **ì´ìŠˆê´€ë¦¬**

- JIRA
- Git Kraken
- Source Tree

### **í˜•ìƒê´€ë¦¬**

- GitLab

### **ì»¤ë®¤ë‹ˆì¼€ì´ì…˜**

- notion
- Mattermost

### **ë””ìì¸**

- Figma

### **UCC**

- í”„ë¦¬ë¯¸ì–´ í”„ë¡œ

### **CI/CD**

- Jenkins
- Portainer

# 3. ê°œë°œí™˜ê²½

- VSCode
- Intellij IDEA Ultimate 2023.3
- Java 21
- Spring Boot 3.2.3
- Gradle 8.5
- Anaconda
- Pycharm
- Jupyter

# 4. ê¸°ìˆ  ì„¸ë¶€ ìŠ¤íƒ

### í”„ë¡ íŠ¸ì—”ë“œ

```json
"packages": {
    "": {
      "name": "init-env",
      "version": "0.0.0",
      "dependencies": {
        "@dimforge/rapier3d-compat": "^0.12.0",
        "@react-spring/three": "^9.7.3",
        "@react-spring/web": "^9.7.3",
        "@react-three/drei": "^9.102.3",
        "@react-three/fiber": "^8.16.0",
        "@react-three/rapier": "^1.3.0",
        "apexcharts": "^3.48.0",
        "axios": "^1.6.8",
        "d3-scale": "^4.0.2",
        "d3-scale-chromatic": "^3.1.0",
        "date-fns": "^3.6.0",
        "esbuild": "^0.20.2",
        "gsap": "^3.12.5",
        "lottie-react": "^2.4.0",
        "react": "^18.2.0",
        "react-apexcharts": "^1.4.1",
        "react-d3-cloud": "^1.0.6",
        "react-dom": "^18.2.0",
        "react-router-dom": "^6.22.3",
        "three": "^0.162.0",
        "zustand": "^4.5.2"
      },
      "devDependencies": {
        "@types/react": "^18.2.64",
        "@types/react-dom": "^18.2.21",
        "@typescript-eslint/eslint-plugin": "^6.21.0",
        "@vitejs/plugin-react-swc": "^3.5.0",
        "autoprefixer": "^10.4.18",
        "eslint": "^8.57.0",
        "eslint-config-airbnb": "^19.0.4",
        "eslint-config-prettier": "^9.1.0",
        "eslint-config-standard-with-typescript": "^43.0.1",
        "eslint-plugin-import": "^2.29.1",
        "eslint-plugin-jsx-a11y": "^6.8.0",
        "eslint-plugin-n": "^16.6.2",
        "eslint-plugin-prettier": "^5.1.3",
        "eslint-plugin-promise": "^6.1.1",
        "eslint-plugin-react": "^7.34.0",
        "eslint-plugin-react-hooks": "^4.6.0",
        "eslint-plugin-react-refresh": "^0.4.5",
        "postcss": "^8.4.35",
        "prettier": "^3.2.5",
        "tailwindcss": "^3.4.1",
        "vite": "^5.1.6"
      }
    }

```

### ë°±ì—”ë“œ

- lombok: 1.18.30
- Spring Data JPA : 3.2.3
- mariadb-driver 3.3.3
- spring-data-elasticsearch:4.2.2
- spring doc : 2.0.2

### ë°ì´í„°(Python)

```
blinker==1.7.0
body_scan==1.0.6
botanist==1.0.0
click==8.1.7
confluent-kafka==2.3.0
emoji==1.2.0
Flask==3.0.2
iniconfig==2.0.0
itsdangerous==2.1.2
joblib==1.3.2
JPype1==1.5.0
konlpy==0.6.0
kss==4.5.4
linkify-it-py==2.0.3
lxml==5.1.0
Mako==1.3.2
Markdown==3.5.2
markdown-it-py==3.0.0
mdit-py-plugins==0.4.0
mdurl==0.1.2

networkx==3.1
onesie==1.0.9
pandas==2.0.3
pdoc3==0.10.0
pecab==1.0.8
pluggy==1.4.0
ply==3.11
producer==1.0.1
pyarrow==15.0.1
PyQt5==5.15.10
regex==2023.12.25
rich==13.7.1
scikit-learn==1.3.2
scipy==1.10.1
shares==3.1.9
textual==0.52.1
threadpoolctl==3.3.0
tinydb==4.8.0
uc-micro-py==1.0.3
webencodings==0.5.1
Werkzeug==3.0.1
```

### ì¸í”„ë¼

- Docker : 25.0.4
- docker-compose 1.25.0
- nginx 1.18.0
- jenkins

# 5. ì™¸ë¶€ ì„œë¹„ìŠ¤

- Open AI
- Kakao OAuth
- S3 Bucket

# 6. ë¹Œë“œ

## 1. í™˜ê²½ë³€ìˆ˜ í˜•íƒœ

### 1) ë°±ì—”ë“œ

SPRING_PROFILES_ACTIVE={yml active ì„¤ì •}
ES_HOSTNAME={ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ url ì£¼ì†Œ}
KAKAO_CLIENT_ID={ì¹´ì¹´ì˜¤ í´ë¼ì´ì–¸íŠ¸ ID}
KAKAO_REDIRECT_URL={ì¹´ì¹´ì˜¤ ë¦¬ë‹¤ì´ë ‰íŠ¸ URL}
MYSQL_URL={MariaDB url}
MYSQL_ROOT_PASSWORD={MariaDB ë£¨íŠ¸ê³„ì • íŒ¨ìŠ¤ì›Œë“œ}
MYSQL_DATABASE={MariaDB ë°ì´í„°ë² ì´ìŠ¤ ì´ë¦„}
MYSQL_USER={MariaDB ìœ ì €ì´ë¦„}
OPENAI_FINETUNING_MODEL={ì˜¤í”ˆAI íŠœë‹ ëª¨ë¸}
OPENAI_KEY={OpenAI í‚¤}
OPENAI_CHAT_URL={OpenAI ì±— URL}

### 2) í”„ë¡ íŠ¸ì—”ë“œ

VITE_BASE_API={ë°±ì—”ë“œ ì„œë²„ BASE url}
VITE_KAKAO_API={ì¹´ì¹´ì˜¤ API}
VITE_KAKAO_REDIRECT_URI={ì¹´ì¹´ì˜¤ ë¦¬ë‹¤ì´ë ‰íŠ¸ URL}

### 3) ë°ì´í„°

1. Airflow

ACCESS_KEY_ID={S3 ì•¡ì„¸ìŠ¤ í‚¤ ID}

SECRET_KEY_ID={S3 ì‹œí¬ë¦¿ í‚¤ ID}

AIRFLOW_UID={Airflow UID default 50000}

## 2. ë¹Œë“œí•˜ê¸°

1. ìŠ¤í”„ë§ë¶€íŠ¸ ë¹Œë“œí•˜ê¸°
    - ./gradlew build -x test ë¡œ app.jar ìƒì„±
2. .env íŒŒì¼ì„ docker-compose.ymlê³¼ ê°™ì€ ë””ë ‰í† ë¦¬ì— ìƒì„±
3. í”„ë¡œì íŠ¸ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì˜ docker-compose.yml íŒŒì¼ ì‹¤í–‰
4. MariaDBì— ê³„ì • ìƒì„± í›„ ê¶Œí•œ ì¶”ê°€

<aside>
ğŸ’¡ dockerë¥¼ í†µí•´ mariaDB ì ‘ê·¼

`use mysql;
create user '{USER_NAME}'@'%' identified by '{USER_PASSWORD}';
grant all privileges on **.** to '{USER_NAME}'@'%';
flush privileges;`

</aside>

5. ìœ„ì˜ docker-compose íŒŒì¼ì—ì„œ **í”„ë¡ íŠ¸ ì›¹ì„œë²„**, **ìŠ¤í”„ë§ë¶€íŠ¸ ë°±ì—”ë“œ ì„œë²„**, **MariaDB ë°ì´í„°ë² ì´ìŠ¤** ì»¨í…Œì´ë„ˆ ìƒì„±
6. í”„ë¡œì íŠ¸ data/elkì˜ docker-compose.yml íŒŒì¼ì„ í†µí•´ Elasticsearch ì»¨í…Œì´ë„ˆ ìƒì„± í›„ ì‹¤í–‰
7. í”„ë¡œì íŠ¸ data/kafkaì˜ docker-compose.yml íŒŒì¼ì„ í†µí•´ Kafka ì»¨í…Œì´ë„ˆ ìƒì„± í›„ ì‹¤í–‰
    - volumesì„ ì €ì¥í•˜ê¸° ìœ„í•œ í´ë” ë§ˆìš´íŠ¸ í•„ìš”
8. data/sparkì˜ docker-compose.yml íŒŒì¼ì„ í†µí•´ ìŠ¤íŒŒí¬ ì»¨í…Œì´ë„ˆ ìƒì„±
    - ë™ì‘ì‹œí‚¤ê¸° ìœ„í•´ì„œëŠ” docker ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì— ë“¤ì–´ê°€ì„œ code/run.pyë¥¼ ì‹¤í–‰í•´ì•¼ í•¨
    - `spark-submit --master spark://spark:7077 [run.py](http://run.py/)`
9. data/airflowì—ì„œ docker-compose.yml íŒŒì¼ì„ í†µí•´ airflow ì‹¤í–‰
    - airflowì˜ dag íŒŒì¼ì—ì„œëŠ” S3ë¥¼ ê°€ë¦¬í‚¤ê³  ìˆìœ¼ë¯€ë¡œ ì•¡ì„¸ìŠ¤í‚¤, ì‹œí¬ë¦¿ í‚¤ë¥¼ ì¶”ê°€í•´ì•¼í•¨.
    - ë¡œì»¬ì—ì„œ ëŒë¦´ ê²½ìš° ë¡œì»¬ì˜ ê²½ë¡œ ì„¤ì • í•„ìš”

## 3. ë°°í¬í•˜ê¸°

### 1) Nginx ì„¤ì •

```bash
server {
        listen 80 default_server;
        listen [::]:80 default_server;
        root /var/www/html;
        # Add index.php to the list if you are using PHP
        index index.html index.htm index.nginx-debian.html;

        server_name _;

        location / {
                # First attempt to serve request as file, then
                #                 # as directory, then fall back to displaying a 404.

                try_files $uri $uri/ =404;
        }
}

server {
        root /var/www/html;
        # Add index.php to the list if you are using PHP
        index index.html index.htm index.nginx-debian.html;
    server_name bibibig.ddnsking.com; # managed by Certbot

        location / {
                proxy_set_header        HOST $http_host;
                proxy_set_header        X-Real-IP $remote_addr;
                proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_set_header        X-Forwarded-Proto $scheme;
                proxy_set_header        X-NginX-Proxy true;
                proxy_pass http://localhost:5173;
               # try_files $uri $uri/ =404;

        }
        location /api {
                proxy_set_header        HOST $http_host;
                proxy_set_header        X-Real-IP $remote_addr;
                proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_set_header        X-Forwarded-Proto $scheme;
                proxy_set_header        X-NginX-Proxy true;
                proxy_pass http://localhost:8081;
        }

    listen [::]:443 ssl ipv6only=on; # managed by Certbot
    listen 443 ssl; # managed by Certbot
    ssl_certificate /etc/letsencrypt/live/bibibig.ddnsking.com/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/bibibig.ddnsking.com/privkey.pem; # managed by Certbot
    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot

}
server {
    if ($host = bibibig.ddnsking.com) {
        return 301 https://$host$request_uri;
    } # managed by Certbot

        listen 80 ;
        listen [::]:80 ;
    server_name bibibig.ddnsking.com;
    return 404; # managed by Certbot
}
```

### 2) Jenkins íŒŒì´í”„ë¼ì¸

```bash
pipeline {
    agent any
    
    tools {
        gradle "gradle" // Specify the Gradle tool name configured in Jenkins
    }
    
    stages {
        stage('Clone Repository') {
            steps {
                script {
                    git branch: 'master', credentialsId: 'gitlab-access-token', url: 'https://lab.ssafy.com/s10-bigdata-dist-sub2/S10P22B307.git'
                }
            }
        }
        
        stage('Prebuild') { 
            steps {
	            script {
                    sh 'ssh ubuntu@j10b307.p.ssafy.io "sudo sh ~/deploy/backend/pre_deploy.sh"'
        	    }
            }
        }

        
        stage('Build') { 
            steps {
	            dir('back-end') {
                    sh 'gradle clean build -x test'
        	    }
            }
        }
        
         //í…ŒìŠ¤íŠ¸ ê³¼ì • ìƒëµ
         
        stage('Deploy') { 
            steps {
                sh 'ssh ubuntu@j10b307.p.ssafy.io "sudo sh ~/deploy/backend/deploy.sh"'
            }
        }
    }
   
    post {
        success {
        	script {
                def Author_ID = sh(script: "git show -s --pretty=%an", returnStdout: true).trim()
                def Author_Name = sh(script: "git show -s --pretty=%ae", returnStdout: true).trim()
                mattermostSend (color: 'good', 
                message: "ë¹Œë“œ ì„±ê³µ: ${env.JOB_NAME} #${env.BUILD_NUMBER} by ${Author_ID}(${Author_Name})\n(<${env.BUILD_URL}|Details>)", 
                endpoint: 'https://meeting.ssafy.com/hooks/urnikbx5sibrmr5g1nu7ce8y1y', 
                channel: 'B307-build'
                )
            }
        }
        failure {
        	script {
                def Author_ID = sh(script: "git show -s --pretty=%an", returnStdout: true).trim()
                def Author_Name = sh(script: "git show -s --pretty=%ae", returnStdout: true).trim()
                mattermostSend (color: 'danger', 
                message: "ë¹Œë“œ ì‹¤íŒ¨: ${env.JOB_NAME} #${env.BUILD_NUMBER} by ${Author_ID}(${Author_Name})\n(<${env.BUILD_URL}|Details>)", 
                endpoint: 'https://meeting.ssafy.com/hooks/urnikbx5sibrmr5g1nu7ce8y1y', 
                channel: 'B307-build'
                )
            }
        }
    }
    
}
```
